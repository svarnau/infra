*filter
:INPUT ACCEPT [0:0]
:FORWARD DROP [0:0]
:OUTPUT ACCEPT [0:0]
:BLACKLIST - [0:0]
:LOGDROP - [0:0]
:TRAF-INPUT - [0:0]
-A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT
-A INPUT -i lo -j ACCEPT
-A INPUT -j BLACKLIST
-A INPUT -j TRAF-INPUT
-A INPUT -m limit --limit 1/sec -j LOG --log-prefix drop_packet --log-level 7
-A INPUT -j DROP
<% blacklist_rules4.each do |blacklist| -%>
-A BLACKLIST <%= blacklist %>
<% end -%>
# Log IP making more than 1 connection per second for SSH
-A LOGDROP -p tcp -m tcp --dport 22 -m limit --limit 1/sec -j LOG --log-prefix ssh_blacklist --log-level 7
-A LOGDROP -j REJECT --reject-with icmp-host-prohibited
#-A TRAF-INPUT -p icmp -m limit --limit 1/sec -m icmp --icmp-type any -j ACCEPT
# SSH from anywhere
-A TRAF-INPUT -m state --state NEW -m tcp -p tcp --dport 22 -j ACCEPT
# SNMP from trafodion cacti
#-A TRAF-INPUT -m udp -p udp --dport 161 -s 15.125.67.199 -j ACCEPT
#-A TRAF-INPUT -m udp -p udp --dport 161 -s 192.168.0.99 -j ACCEPT
# Public TCP ports
<% public_tcp_ports.each do |port| -%>
-A TRAF-INPUT -m state --state NEW -m tcp -p tcp --dport <%= port %> -j ACCEPT
<% end -%>
# Public UDP ports
<% public_udp_ports.each do |port| -%>
-A TRAF-INPUT -m udp -p udp --dport <%= port %> -j ACCEPT
<% end -%>
# Per-host rules
<% rules4.each do |rule| -%>
-A TRAF-INPUT <%= rule %>
<% end -%>
-A TRAF-INPUT -j REJECT --reject-with icmp-host-prohibited
COMMIT
